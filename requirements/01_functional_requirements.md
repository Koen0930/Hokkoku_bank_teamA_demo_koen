# 機能要件 (Functional Requirements)

## 概要
本ドキュメントでは、AIシフト作成ツールの機能要件を定義します。

## 機能一覧

### F-01: CSV取込
**詳細**: エクセル形式（CSV）で従業員マスタ・勤務制約をアップロード

**仕様**:
- CSVファイルのドラッグ&ドロップアップロード対応
- 従業員情報（ID、名前、役職、スキルレベル等）の取込
- 勤務制約（休日希望、勤務時間制限等）の取込
- アップロード時のデータ検証・エラー表示
- サンプルCSVテンプレートのダウンロード機能

### F-02: シフト自動生成
**詳細**: OR-Tools CP-SATにより、下記制約を満たす最適解を算出

**制約条件**:
- 設置人員数
- 24時間制シフト配置（複数シフト/日対応）
- シフト後2時間枠休憩確保
- 各時間帯管理職2名以上配置
- 制約NGへの回避

**最適化目標**:
- 人員配置の均等化
- 従業員満足度の最大化
- 運用コストの最小化

### F-03: リアルタイム警告
**詳細**: シフト編集時の制約違反を即座に検知・警告表示

**警告種類**:
- 人員不足警告
- 連続時間枠配置警告
- スキル要件不足警告
- 労働時間制限違反警告

### F-04: ドラッグ&ドロップ編集
**詳細**: 直感的なシフト調整機能

**機能**:
- 従業員の時間枠間移動
- シフトのコピー&ペースト
- 一括編集機能
- 編集履歴の保持

### F-05: フィルタリング・検索
**詳細**: 効率的なシフト確認・編集支援

**機能**:
- 従業員名での絞り込み
- 日付範囲での絞り込み
- 勤務パターンでの絞り込み
- 制約違反箇所のハイライト表示

### F-06: エクスポート
**詳細**: 完成したシフト表の出力機能

**出力形式**:
- CSV形式でのダウンロード
- PDF形式でのダウンロード
- Excel形式での出力対応

### F-07: ログ機能
**詳細**: システム利用状況の記録・追跡

**記録内容**:
- ユーザー操作履歴
- シフト変更履歴
- エラー発生履歴
- パフォーマンス指標

### F-08: 再計算機能
**詳細**: 制約条件変更時の自動再最適化

**機能**:
- 制約条件変更の検知
- 影響範囲の分析
- 部分的な再最適化実行
- 変更前後の比較表示

### F-09: LLMによる難しかった点の分析機能
**詳細**: シフト作成時に発生した問題やエラーをChatGPT APIで分析し、ユーザーに分かりやすく説明

**機能**:
- **設定画面**: ChatGPT APIキーの入力・保存機能
- **表示位置**: シフト表の上部、制約条件表示の下
- **表示形式**: 「LLMからのシフト作成構成する際に難しかった点」というタイトルの下にコメント形式で表示
- **分析対象**: OR-Toolsのエラー内容、制約条件の競合、最適化の困難な点、従業員配置の問題
- **ChatGPT APIシステムプロンプト**: 「シフト作成してその結果難しかった点やエラー内容を入力するので、何が難しかった方を記載してください」
- **成功時の表示**: エラーがない場合は「特に問題なくシフトを生成できました」等の表示
- **実装要件**: ChatGPT API統合、エラー内容の構造化、レスポンスの日本語表示、非同期処理、エラーハンドリング

## 優先度

| 機能ID | 機能名 | 優先度 | MVP対象 |
|--------|--------|--------|---------|
| F-01 | CSV取込 | 高 | ✓ |
| F-02 | シフト自動生成 | 高 | ✓ |
| F-03 | リアルタイム警告 | 高 | ✓ |
| F-04 | ドラッグ&ドロップ編集 | 中 | ✓ |
| F-05 | フィルタリング・検索 | 中 | ✓ |
| F-06 | エクスポート | 高 | ✓ |
| F-07 | ログ機能 | 低 | △ |
| F-08 | 再計算機能 | 中 | ✓ |

## 受入基準
各機能は以下の基準を満たす必要があります：

1. **動作確認**: 正常系・異常系の両方で期待通りに動作する
2. **パフォーマンス**: レスポンス時間が許容範囲内である
3. **ユーザビリティ**: 直感的で使いやすいインターフェースである
4. **データ整合性**: データの整合性が保たれている
